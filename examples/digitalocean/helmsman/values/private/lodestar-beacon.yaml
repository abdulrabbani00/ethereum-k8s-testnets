replicas: 2

image:
  repository: chainsafe/lodestar
  tag: next
  pullPolicy: IfNotPresent

mode: "beacon"

extraArgs:
  - --genesisStateFile=/data/testnet_spec/genesis.ssz
  - --paramsFile=/data/testnet_spec/config.yaml
  - --network.discv5.bootEnrs="$(cat /data/testnet_spec/bootstrap_nodes.txt)"
  - --network.connectToDiscv5Bootnodes=true
  - --eth1.enabled
  - --eth1.providerUrls=http://geth.ethereum-private.svc.cluster.local:8545
  - --logLevel=info
  - --eth1.depositContractDeployBlock=$(cat /data/testnet_spec/deploy_block.txt)
initContainers:
- name: init-genesis
  image: alpine:latest
  imagePullPolicy: IfNotPresent
  securityContext:
    runAsNonRoot: false
    runAsUser: 0
  command:
    - sh
    - -ace
    - >
      mkdir -p /data/testnet_spec;
      if ! [ -f /data/testnet_spec/genesis.ssz ];
      then
        wget -O /data/testnet_spec/deposit_contract.txt http://genesis-cl:8000/deposit_contract.txt;
        wget -O /data/testnet_spec/deploy_block.txt http://genesis-cl:8000/deploy_block.txt;
        wget -O /data/testnet_spec/config.yaml http://genesis-cl:8000/config.yaml;
        wget -O /data/testnet_spec/genesis.ssz http://genesis-cl:8000/genesis.ssz;
        echo "genesis init done";
      else
        echo "genesis exists. skipping...";
      fi;
      wget -O /data/testnet_spec/bootstrap_nodes.txt http://lighthouse-bootnode-0.lighthouse-bootnode-headless.ethereum-private.svc.cluster.local:8888/enr;
  volumeMounts:
    - name: storage
      mountPath: "/data"

#persistence:
#  enabled: true
#  size: 2Gi

resources: {}
